<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.renren.modules.inspection.dao.InspectionTaskDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="io.renren.modules.inspection.entity.InspectionTaskEntity" id="inspectionTaskMap">
        <result property="id" column="id"/>
        <result property="lineId" column="line_id"/>
        <result property="turnId" column="turn_id"/>
        <result property="inspectionSpanEndDate" column="inspection_span_end_date"/>
        <result property="inspectDeviceCount" column="inspect_device_count"/>
        <result property="inspectedDeviceCount" column="inspected_device_count"/>
        <result property="inspectItemCount" column="inspect_item_count"/>
        <result property="inspectedItemCount" column="inspected_item_count"/>
        <result property="isInspected" column="is_inspected"/>
        <result property="isSpan" column="is_span"/>
    </resultMap>

    <select id="selectByDate" resultType="java.util.HashMap" parameterType="java.lang.String">
        select sum(inspected_item_count) as inspectedItemSum,sum(inspect_item_count) as inspectItemSum
        from tb_inspection_task
        where inspection_span_end_date='${inspectDate}'
    </select>

    <select id="selectListByDate" resultType="java.util.HashMap" parameterType="java.lang.String">
        select dept.name as dept_name,line.name as line_name,case line.period_type when 1 then '天' when 2 then '日' when 3 then '月' end as period_type,turn.name as turn_name,case period.turn_finish_mod when 0 then '全体完成' when 1 then '班组完成' when 2 then '个人完成' end as turn_finish_mod, task.turn_start_time,task.turn_end_time
        from tb_inspection_task as task
        left join tb_inspection_line as line on line.id=task.`line_id`
        left join tb_turn as turn on turn.id=task.turn_id
        left join sys_dept as dept on dept.dept_id=line.dept_id
        left join tb_inspection_period as period on period.line_id=line.id
        where inspection_span_end_date > '${inspectStartDate}' and inspection_span_end_date &lt; '${inspectEndDate}'
        order by turn_start_time desc
        </select>
</mapper>